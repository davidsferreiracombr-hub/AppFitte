{
  "entities": {
    "Recipe": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Recipe",
      "type": "object",
      "description": "Represents a healthy dessert recipe.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Recipe entity."
        },
        "title": {
          "type": "string",
          "description": "Title of the recipe."
        },
        "description": {
          "type": "string",
          "description": "A brief description of the recipe."
        },
        "ingredients": {
          "type": "array",
          "description": "List of ingredients required for the recipe.",
          "items": {
            "type": "string"
          }
        },
        "instructions": {
          "type": "array",
          "description": "Step-by-step instructions for preparing the recipe.",
          "items": {
            "type": "string"
          }
        },
        "cookingTime": {
          "type": "string",
          "description": "The total time required to prepare the recipe."
        },
        "nutritionalInformation": {
          "type": "string",
          "description": "Comprehensive nutritional data for the recipe."
        },
        "dietaryRestrictions": {
          "type": "array",
          "description": "Dietary restrictions applicable to the recipe (e.g., gluten-free, dairy-free).",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "title",
        "description",
        "ingredients",
        "instructions",
        "cookingTime",
        "nutritionalInformation"
      ]
    },
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "favoriteRecipeIds": {
          "type": "array",
          "description": "References to Recipes. (Relationship: UserProfile 1:N Recipe)",
          "items": {
            "type": "string"
          }
        },
        "fitnessGoals": {
          "type": "string",
          "description": "User's personal fitness goals."
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "ForumPost": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ForumPost",
      "type": "object",
      "description": "Represents a post in the community forum.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ForumPost entity."
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N ForumPost)"
        },
        "recipeId": {
          "type": "string",
          "description": "Optional reference to Recipe. (Relationship: Recipe 1:N ForumPost)"
        },
        "content": {
          "type": "string",
          "description": "Content of the forum post."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the post was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userProfileId",
        "content",
        "timestamp"
      ]
    },
    "UserSession": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserSession",
      "type": "object",
      "description": "Manages user login sessions, allowing one active session per user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserSession entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "lastLogin": {
          "type": "string",
          "description": "Timestamp of the last login.",
          "format": "date-time"
        },
        "deviceInfo": {
          "type": "string",
          "description": "Information about the device used for the login."
        }
      },
      "required": [
        "id",
        "email",
        "lastLogin",
        "deviceInfo"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. Only the user can access their own profile data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/recipes/{recipeId}",
        "definition": {
          "entityName": "Recipe",
          "schema": {
            "$ref": "#/backend/entities/Recipe"
          },
          "description": "Stores recipe data. Recipes are globally accessible.",
          "params": [
            {
              "name": "recipeId",
              "description": "The unique identifier of the recipe."
            }
          ]
        }
      },
      {
        "path": "/forum_posts/{postId}",
        "definition": {
          "entityName": "ForumPost",
          "schema": {
            "$ref": "#/backend/entities/ForumPost"
          },
          "description": "Stores forum posts. Posts are linked to users via the `userProfileId` field.",
          "params": [
            {
              "name": "postId",
              "description": "The unique identifier of the forum post."
            }
          ]
        }
      },
      {
        "path": "/user_sessions/{sessionId}",
        "definition": {
          "entityName": "UserSession",
          "schema": {
            "$ref": "#/backend/entities/UserSession"
          },
          "description": "Manages active user sessions. Enforces single-session login constraint.",
          "params": [
            {
              "name": "sessionId",
              "description": "The unique identifier of the user session."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore data structure is designed to support the Fit Sweet Delights application, focusing on scalability, security, and ease of maintenance. Given the user request for a single password login system and single device access, a `UserSession` collection is utilized to enforce the single login constraint. User profiles, recipes, and forum posts are structured to facilitate efficient data access and management.\n\n**Authorization Independence:** The design avoids hierarchical authorization dependencies (`get()` calls in security rules). User-specific data is stored under `/users/{userId}`, and the `UserSession` collection tracks active sessions to enforce the single device login requirement. This denormalization ensures atomic operations are possible without needing to fetch parent document data.\n\n**Structural Segregation:**  Data with different access requirements are stored in separate collections.  User profiles are stored in `/users/{userId}`, recipes are stored in `/recipes`, and forum posts are stored in `/forum_posts`. This segregation simplifies security rules.\n\n**Access Modeling:**\n*   **Private Data:** User profiles are stored under `/users/{userId}`, following the path-based ownership pattern. This ensures that only the user can access their own profile data.\n*   **Collaborative Data:** There are no explicit collaborative entities in this design.\n*   **Global Roles (DBAC):**  The single-password access is managed via the `UserSession` collection. If a user logs in from a new device, the previous session is invalidated.\n\n**QAPs (Rules are not Filters):** The structure is designed to allow secure `list` operations. The segregation of data into different collections based on access requirements ensures that listing operations can be secured using simple rules.\n\n\n**Explanation of Collections:**\n\n*   **/users/{userId} (UserProfile):** Stores user profile information. Each user has their own document, enabling secure access to their data.\n*   **/recipes/{recipeId} (Recipe):** Stores recipe data. Recipes are globally accessible but could be managed by admins (this requires a separate admin role implementation).\n*   **/forum_posts/{postId} (ForumPost):** Stores forum posts. Posts are linked to users via the `userProfileId` field. Security rules can enforce that only the user can delete or modify their posts.\n*   **/user_sessions/{sessionId} (UserSession):** Manages active user sessions. Each document stores the email, last login timestamp, and device information.  The presence of a session document indicates an active login. A Firestore function will be triggered on creation, deletion and write of this document to enforce single-session constraint."
  }
}